# 変更履歴
このプロジェクトの全ての重要な変更はこのファイルに記録されます。

フォーマットは[Keep a Changelog](https://keepachangelog.com/ja/1.0.0/)に基づいており、
このプロジェクトは[Semantic Versioning](https://semver.org/lang/ja/)に準拠しています。

## [v0.2.0] - 2025-06-15

### 追加
- **対話形式の管理スクリプト**: サービスのインストール、更新、アンインストールを簡単に行える `service-manager.sh` を導入。
- **Makefileのサポート**: `make install` や `make status` といった簡単なコマンドでサービスを管理できる `Makefile` を追加。
- **ファイル形式の選択**: ファイル出力時に `csv` と `json` の形式を選択できるように改善。

### 変更
- **インストールプロセス**: `service-manager.sh` を中心に、より堅牢でユーザーフレンドリーなインストールフローに大幅に改善。
- **設定更新のロジック**: `update` 実行時に `.env` を読み込まず、常に新しい設定で上書きすることで、予測可能な動作を保証。
- **スクリプトアーキテクチャ**: シェルスクリプトをリファクタリングし、主要なロジックが `.env` ファイルに依存しないように変更し、信頼性を向上。

### 修正
- **バージョン検知の不具合**: インストール時に `.git` ディレクトリがコピーされるように修正し、`setuptools-scm` がバージョンを正しく検知できるようにした。
- **対話プロンプトの表示**: スクリプトの出力がリダイレクトされた際に、プロンプトが表示されなくなる問題を解決。
- **サービスファイルの生成**: ユーザーが選択した設定に基づいて、`systemd`のサービスファイルが常に正しい引数で生成されるように修正。

## [0.1.0] - 2025-06-09

### 追加
- **データ取得機能**: 瞬時電力、瞬時電流、積算電力量に加え、30分ごとの定時積算電力量(EA)、直近30分間の消費電力量(EC)を取得する機能。
- **実行モード**: `schedule` (cron形式) と `interval` (固定間隔) の2つの実行モードをサポート。
- **多様な出力**: `stdout`, `file`, `Google Cloud Pub/Sub`, `webhook`への出力、`json`, `yaml`, `csv`形式のサポート、および複数出力先の同時指定に対応。
- **ECHONET Lite準拠強化**: 瞬時電力・電流の負値解釈、単相・三相の自動判別、積算電力量単位の動的取得など、仕様への準拠を強化。
- **タイムゾーン対応**: データ取得元のタイムゾーンを指定可能にし、全てのタイムスタンプをUTCに統一して出力。
- **パッケージング**: `setuptools`を導入し、pipでのインストールに対応。
- **コマンドライン拡充**: `--version`, `--debug`など、多数のオプションを追加し、環境変数での設定を強化。
